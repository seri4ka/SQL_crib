## Общий вид паттерна SQL конструкции
### Основная структура SQL-запроса может быть представлена следующим образом:

```SQL
SELECT [столбцы]
FROM [таблица]
[JOIN [другая_таблица] ON [условие_join]]
[WHERE [условие]]
[GROUP BY [столбцы]]
[HAVING [условие]]
[ORDER BY [столбцы] [ASC|DESC]]
[LIMIT [число]];
```

### Компоненты запроса
1. **SELECT**: Указывает, какие столбцы нужно вернуть в результате. Можно использовать * для выбора всех столбцов.

Пример:  

```SQL
SELECT employee_name, salary
```

2. **FROM**: Указывает таблицы, из которых будут извлекаться данные.  

Пример:

```SQL
FROM employees
```

3. **JOIN**: Соединяет две или более таблицы на основе заданного условия. Различные типы JOIN:

* INNER JOIN: Возвращает строки, которые имеют совпадения в обеих таблицах.
* LEFT JOIN: Возвращает все строки из левой таблицы и совпадения из правой таблицы.
* RIGHT JOIN: Возвращает все строки из правой таблицы и совпадения из левой таблицы.
* FULL OUTER JOIN: Возвращает строки из обеих таблиц, независимо от совпадений.

Пример:

```SQL
JOIN departments ON employees.department_id = departments.department_id
```

4. **WHERE**: Фильтрует строки, основываясь на заданных условиях. Это условие применяется до других операций.

Пример:

```SQL
WHERE salary > 50000
```

5. **GROUP BY**: Группирует результаты по указанным столбцам. Обычно используется в сочетании с агрегатными функциями (например, SUM, AVG, COUNT).

Пример:

```SQL
GROUP BY department_id
```

6. **HAVING**: Применяет условие к сгруппированным данным. Это условие используется после GROUP BY.

Пример:

```SQL
HAVING COUNT(employee_id) > 5
```

7. **ORDER BY**: Сортирует результаты по указанным столбцам. Можно указать порядок сортировки: по возрастанию (ASC) или убыванию (DESC).

Пример:

```SQL
ORDER BY salary DESC
```

8. **LIMIT**: Ограничивает количество возвращаемых строк. Полезно для пагинации.

Пример:

```SQL
LIMIT 10
```

### Последовательность выполнения шагов запроса
Важно понимать, что SQL выполняет запросы не в том порядке, в котором они написаны. Вот фактическая последовательность выполнения:

1. **FROM**: Определяет таблицы, из которых будут извлекаться данные. Если используются JOIN, они выполняются на этом этапе.

2. **WHERE**: Применяет фильтрацию к строкам на основе указанных условий. Только строки, соответствующие условиям, попадают дальше.

3. **GROUP BY**: Если указано, результаты группируются по указанным столбцам.

4. **HAVING**: Применяет условия к сгруппированным данным. Это позволяет фильтровать результаты после группировки.

5. **SELECT**: Выбирает необходимые столбцы из результирующего набора.

6. **ORDER BY**: Сортирует окончательный набор результатов по указанным столбцам.

7. **LIMIT**: Ограничивает количество возвращаемых строк в результате.

### Пример полного запроса
Вот пример полного SQL-запроса с использованием всех вышеперечисленных компонентов:

```SQL
SELECT employee_name, AVG(salary) AS avg_salary
FROM employees
JOIN departments ON employees.department_id = departments.department_id
WHERE salary > 50000
GROUP BY department_id
HAVING COUNT(employee_id) > 5
ORDER BY avg_salary DESC
LIMIT 10;
```

## Операции DML, DDL, DCL, TCL

### Операции DML (Data Manipulation Language)
**DML** используется для манипуляции данными в существующих таблицах. Основные команды:

1. **INSERT**: Добавляет новые строки в таблицу.

```SQL
INSERT INTO имя_таблицы (столбец1, столбец2)
VALUES (значение1, значение2);
```

2. **UPDATE**: Обновляет существующие строки в таблице.

```SQL
UPDATE: Обновляет существующие строки в таблице.
```

3. **DELETE**: Удаляет строки из таблицы.

```SQL
DELETE FROM имя_таблицы
WHERE условие;
```


### Операции DDL (Data Definition Language)
**DDL** используется для определения структуры базы данных. Основные команды:

1. **CREATE**: Создает новую таблицу, базу данных или другой объект.

```SQL
CREATE TABLE имя_таблицы (
    столбец1 тип_данных,
    столбец2 тип_данных
);
```

2. **ALTER**: Изменяет существующую структуру таблицы.

```SQL
ALTER TABLE имя_таблицы ADD COLUMN новый_столбец тип_данных;
```

3. **DROP**: Удаляет таблицу или другой объект из базы данных.

```SQL
DROP TABLE имя_таблицы;
```

4. **TRUNCATE**: Быстро удаляет все строки из таблицы, но структура остается.

```SQL
TRUNCATE TABLE имя_таблицы;
```

### Операции DCL (Data Control Language)
**DCL** управляет правами доступа к данным. Основные команды:

1. **GRANT**: Предоставляет права пользователям или ролям.

```SQL
GRANT SELECT, INSERT ON имя_таблицы TO имя_пользователя;
```

2. **REVOKE**: Отзывает права у пользователей или ролей.

```SQL
REVOKE INSERT ON имя_таблицы FROM имя_пользователя;
```

3. **DENY**: (в некоторых СУБД) Явно запрещает определенные права.

```SQL
DENY SELECT ON имя_таблицы TO имя_пользователя;
```

### Операции TCL (Transaction Control Language)

TCL управляет транзакциями в базе данных. Основные команды:

1. **COMMIT**: Подтверждает все изменения в текущей транзакции.

```SQL
COMMIT;
```

2. **ROLLBACK**: Отменяет все изменения, сделанные в текущей транзакции.

```SQL
ROLLBACK;
```

3. **SAVEPOINT**: Устанавливает точку, к которой можно откатиться.

```SQL
SAVEPOINT имя_точки;
```

4. **SET TRANSACTION**: Настраивает параметры для текущей транзакции (например, уровень изоляции).

```SQL
SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;
```

## Шпаргалка по работе со множествами

### 1. UNION
Объединяет результаты двух или более SELECT-запросов, удаляя дубликаты. Все запросы должны возвращать одинаковое количество столбцов с совместимыми типами данных.

**Пример:**
```sql
SELECT столбец1 FROM таблица1
UNION
SELECT столбец1 FROM таблица2;
```

### 2. UNION ALL
Объединяет результаты двух или более SELECT-запросов, включая дубликаты. Полезно, когда необходимо сохранить все результаты.

**Пример:**

```sql
SELECT столбец1 FROM таблица1
UNION ALL
SELECT столбец1 FROM таблица2;
```

### 3. EXCEPT
Возвращает строки из первого запроса, которые не присутствуют во втором. Как и в UNION, все запросы должны возвращать одинаковое количество столбцов с совместимыми типами данных.

**Пример:**

```sql
SELECT столбец1 FROM таблица1
EXCEPT
SELECT столбец1 FROM таблица2;
```

### 4. INTERSECT
Возвращает общие строки между двумя запросами. Также требует одинаковое количество столбцов с совместимыми типами данных.

**Пример:**

```sql
SELECT столбец1 FROM таблица1
INTERSECT
SELECT столбец1 FROM таблица2;
```

### 5. IN
Проверяет, содержится ли значение в заданном списке или результатах подзапроса. Возвращает TRUE, если значение найдено.

**Пример:**

```sql
SELECT * FROM таблица WHERE столбец IN (значение1, значение2);
```

### 6. NOT IN
Проверяет, не содержится ли значение в заданном списке или результатах подзапроса. Возвращает TRUE, если значение не найдено.

**Пример:**

```sql
SELECT * FROM таблица WHERE столбец NOT IN (значение1, значение2);
```

## Шпаргалка по операторам объединения в SQL

### JOIN
JOIN объединяет строки из двух или более таблиц на основе связанных столбцов. По умолчанию используется INNER JOIN.

Пример:
```sql
SELECT *
FROM таблица1
JOIN таблица2 ON таблица1.столбец = таблица2.столбец;
```

### INNER JOIN
Возвращает только строки, у которых есть совпадения в обеих таблицах.

Пример:
```sql
SELECT *
FROM таблица1
INNER JOIN таблица2 ON таблица1.столбец = таблица2.столбец;
```


### LEFT JOIN (или LEFT OUTER JOIN)
Возвращает все строки из левой таблицы и совпадающие строки из правой таблицы. Если совпадений нет, возвращаются NULL-значения для правой таблицы.

Пример:
```sql
SELECT *
FROM таблица1
LEFT JOIN таблица2 ON таблица1.столбец = таблица2.столбец;
```


### RIGHT JOIN (или RIGHT OUTER JOIN)
Возвращает все строки из правой таблицы и совпадающие строки из левой таблицы. Если совпадений нет, возвращаются NULL-значения для левой таблицы.

Пример:
```sql
SELECT *
FROM таблица1
RIGHT JOIN таблица2 ON таблица1.столбец = таблица2.столбец;
```

### FULL OUTER JOIN
Возвращает все строки из обеих таблиц, с NULL-значениями для отсутствующих совпадений.

Пример:
```sql
SELECT *
FROM таблица1
FULL OUTER JOIN таблица2 ON таблица1.столбец = таблица2.столбец;
```

### CROSS JOIN
Возвращает декартово произведение двух таблиц, то есть все возможные комбинации строк.

Пример:
```sql
SELECT *
FROM таблица1
CROSS JOIN таблица2;
```

**Декартово произведение** — это математическая операция, которая объединяет все возможные пары элементов из двух множеств. В контексте SQL это означает, что каждая строка из первой таблицы будет соединена с каждой строкой из второй таблицы, что может привести к большому количеству строк в результате.


## Шпаргалка по работе с фильтрами и условными операторами в SQL

### 1. Фильтры и условные операторы

**WHERE**: Используется для фильтрации строк, удовлетворяющих заданным условиям.

Пример:
```sql
SELECT *
FROM таблица
WHERE столбец = значение;
```

### 2. Условные операторы

**AND**: Все условия должны быть истинными.

Пример:
```sql
SELECT *
FROM таблица
WHERE столбец1 = значение1 AND столбец2 = значение2;
```

**OR**: Любое из условий должно быть истинным.

Пример:
```sql
SELECT *
FROM таблица
WHERE столбец1 = значение1 OR столбец2 = значение2;
```

**NOT**: Отрицает условие.  

Пример:
```sql
SELECT *
FROM таблица
WHERE NOT столбец = значение;
```

### 3. Операторы фильтрации

**EXISTS**  
Проверяет существование строк, удовлетворяющих условию. Возвращает TRUE, если подзапрос возвращает хотя бы одну строку.

Пример:  
```sql
SELECT *
FROM таблица1
WHERE EXISTS (
    SELECT *
    FROM таблица2
    WHERE таблица1.столбец = таблица2.столбец
);
```

**IN**  
Проверяет, содержится ли значение в заданном списке или результатах подзапроса. 

Пример:  

```sql
SELECT *
FROM таблица
WHERE столбец IN (значение1, значение2);
```

**NOT IN**  
Проверяет, содержится ли значение в заданном списке или результатах подзапроса. 

Пример:  

```sql
SELECT *
FROM таблица
WHERE столбец NOT IN (значение1, значение2);
```

**ANY**  
Сравнивает значение с любым значением из подзапроса. Если хотя бы одно значение удовлетворяет условию, результат TRUE.

Пример:  

```sql
SELECT *
FROM таблица
WHERE столбец > ANY (SELECT столбец FROM таблица2);
```

**ALL**  
Сравнивает значение со всеми значениями из подзапроса. Если значение удовлетворяет всем условиям, результат TRUE.

Пример:  

```sql
SELECT *
FROM таблица
WHERE столбец > ALL (SELECT столбец FROM таблица2);
```

**LIKE**  
Используется для поиска строк с использованием шаблонов. Основные символы подстановки:

* ```%```: любой набор символов.
* ```_```: один символ.

Пример:  

```sql
SELECT *
FROM таблица
WHERE столбец > ALL (SELECT столбец FROM таблица2);
```

**RLIKE (или REGEXP)**  
Используется для поиска строк с использованием регулярных выражений (поддерживается не во всех СУБД).  

Пример:  

```sql
SELECT *
FROM таблица
WHERE столбец RLIKE '^[A-C].*';  -- Начинается с A, B или C
```
